(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([[50],{"5FNA":function(e,t,n){n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n("qtKf"),o=n("Pqnw"),i=n("Wer7");const s=["alphabetical","last_pinned_to","oldest","newest","group_boards_at_top","custom"],a={name:"BoardsResource",key:"boardsResource",options:({boardOrder:e,mixPublicSecret:t,username:n})=>({privacy_filter:"all",sort:e||"last_pinned_to",field_set_key:"profile_grid_item",username:n,page_size:25,group_by:t?"mix_public_private":"visibility",include_archived:!0,redux_normalize_feed:!0})},c=(e,t,n)=>({privacy_filter:t?"secret":"public",sort:n||"last_pinned_to",field_set_key:"profile_grid_item",username:e}),u=e=>s.reduce((t,n)=>{const s=[Object(o.a)("profileBoards",Object(r.c)(e,n))];return[!0,!1].forEach(t=>{s.push(Object(i.f)(a.name,a.options({username:e,boardOrder:n,mixPublicSecret:t})))}),t.concat(s)},[])},BkRI:function(e,t,n){var r=n("OBhP"),o=1,i=4;e.exports=function(e){return r(e,o|i)}},MhBu:function(e,t,n){function r(e){return{type:"FEED_ITEMS_REMOVED",payload:e}}n.d(t,"a",(function(){return r}))},NjDU:function(e,t,n){function r(e){return{type:"UPDATE_USER_PIN_COUNT",payload:e}}function o(e){return{type:"UPDATE_USER_FOLLOWING_COUNT",payload:e}}function i(e){return{type:"UPDATE_USER_SCHEDULED_PIN_COUNT",payload:e}}function s(e,t){return{type:"UPDATE_USER_SOCIAL_NETWORK",payload:{socialNetworkName:e,connected:t}}}n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return s}))},Pqnw:function(e,t,n){function r(e,t){return{type:"FEED_INVALIDATE",payload:{feedType:e,feedId:t}}}n.d(t,"a",(function(){return r}))},Wrea:function(e,t,n){n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u}));var r=n("Wer7");const o=(e,t)=>n=>n(Object(r.a)("BoardResource",{board_id:e,field_set_key:t})),i=e=>o(e,"pin_count"),s=e=>({type:"BOARD_PIN_COUNT_CHANGED",payload:e}),a=e=>({type:"BOARD_INVITE_ACCEPTED_BY_VIEWER",payload:{boardId:e}}),c=(e,t)=>({type:"BOARD_COVER_IMAGE_UPDATED",payload:{boardId:e,coverPin:t}}),u=e=>({type:"BOARD_DISABLE_MORE_IDEAS_BADGING",payload:{boardId:e}})},ZVWG:function(e,t,n){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o}));const r=(e,t)=>{const n=/^\d{1,3}\.\d{1,3}(?:\.\d{1,6})?$/;if(!e.match(n)||!t.match(n))return null;const r=e.split("."),o=t.split("."),i=Math.max(r.length,o.length);for(let s=0;s<i;s+=1){const e=s<r.length?parseInt(r[s],10):0,t=s<o.length?parseInt(o[s],10):0;if(e<t)return-1;if(e>t)return 1}return 0};function o(e,t,n,r,o,i,s,a){const c=document.createElement("div");if("undefined"==typeof document||!document.body)return 0;document.body.appendChild(c);let u=t;const l={fontFamily:n,fontSize:`${u}px`,letterSpacing:`${o}px`,lineHeight:`${r}`,visibility:"hidden",width:`${s}px`};Object.assign(c.style,l);const d=document.createElement("div");for(d.style.display="inline",c.appendChild(d),e.forEach((t,n)=>{const r=document.createElement("span");r.style.wordBreak="break-word",a&&(r.style.padding=a),d.appendChild(r),r.appendChild(document.createTextNode(t)),n!==e.length-1&&r.appendChild(document.createElement("br"))});d.offsetHeight>i&&u>0;)u-=1,c.style.fontSize=`${u}px`;return d.remove(),c.remove(),u}},"bo/h":function(e,t,n){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i}));const r="0.4.0",o="0.8.0";function i(e,t=1){return e?`${e*(t-1)}px ${e/5}px`:".05em .2em"}},c50B:function(e,t,n){n.d(t,"o",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return s})),n.d(t,"m",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"n",(function(){return u})),n.d(t,"i",(function(){return l})),n.d(t,"l",(function(){return d})),n.d(t,"q",(function(){return h})),n.d(t,"j",(function(){return p})),n.d(t,"f",(function(){return f})),n.d(t,"g",(function(){return m})),n.d(t,"h",(function(){return g})),n.d(t,"b",(function(){return _})),n.d(t,"c",(function(){return b})),n.d(t,"s",(function(){return y})),n.d(t,"p",(function(){return E})),n.d(t,"k",(function(){return x})),n.d(t,"r",(function(){return A})),n.d(t,"t",(function(){return C}));const r=e=>{const t={"０":"0","１":"1","２":"2","３":"3","４":"4","５":"5","６":"6","７":"7","８":"8","９":"9","　":" "},n=String(e).split("");return n.forEach((e,r)=>{const o=t[e];o&&(n[r]=o)}),n.join("")};function o(e){return function(t,n){const r=[];t&&/\S/.test(t)||r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}const i=new RegExp(["(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*",'|^"([\\001-\\010\\013\\014\\016-\\037!#-\\[\\]-\\177]|\\\\[\\001-\\011\\013\\014\\016-\\177])*"',")@((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+[A-Z]{2,20}$)","|\\[(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)(\\.(25[0-5]|2[0-4]\\d|[0-1]?\\d?\\d)){3}\\]$"].join(""),"i");function s(e){return function(t,n){const r=[];(t=t&&t.trim())&&!t.match(i)&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function a(e){return function(t,n){const r=[];(t=t&&t.trim())&&!t.match(/^[^0-9].*$/)&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function c(e){return function(t,n){const o=r(t.trim()),i=[];o&&""!==o&&o.length<2&&i.push(e.ageTooShortString);const s=Math.floor(parseInt(o,10));""===o||/^\d+$/.test(o)&&s>0&&s<300||i.push(e.invalidAgeString);const a={errors:i,warnings:[]};return n&&n(a),a}}function u(e){return function(t,n){const r=(t=t&&t.trim()).replace(/[\(\)\+\-\. ]/g,""),o=[],i=!1!==e.checkLength&&r.length<7;!t||t.match(/^(\(?\+?[0-9]*\)?)?[0-9_\- \.\(\)]*$/g)&&!i||o.push(e.message);const s={errors:o,warnings:[]};return n&&n(s),s}}function l(e){return function(t,n){const o=/^\d+$/,i=[];"number"==typeof t||"string"==typeof t&&(t=t&&t.trim(),(t=r(t))&&!t.match(o)&&i.push(e.message));const s={errors:i,warnings:[]};return n&&n(s),s}}function d(e){return function(t,n){const o=/^[\d\ -]+$/,i=[];"number"==typeof t||"string"==typeof t&&(t=t&&t.trim(),(t=r(t))&&!t.match(o)&&i.push(e.message));const s={errors:i,warnings:[]};return n&&n(s),s}}function h(e){return function(t,n){const r=[];t&&!t.match(/^(https?:\/\/){0,1}[a-z0-9_\-]+\..+/gi)&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function p(e){return function(t,n){const r=[];(e.should_trim||!1)&&(t=t&&t.trim());const o=t.length;e.min&&o<e.min?r.push(e.minErrorString):e.max&&o>e.max&&r.push(e.maxErrorString);const i={errors:r,warnings:[]};return n&&n(i),i}}function f(e){return function(t,n){const r=[];t!==(e&&e.targetValue)&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function m(e){return function(t,n){t&&(t=parseFloat(t));const r=[];t<=e.value&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function g(e){return function(t,n){t&&(t=parseFloat(t));const r=[];t<e.value&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function _(e){return function(t,n){const r=[];/^[\040-\176]*$/.test(t)||r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function b(e){return function(t,n){const r=e.hasFractionalCents?/^\d*(\.\d\d?\d?)?$/:/^\d*(\.\d\d?)?$/,o=[];"number"==typeof t&&(t=t.toString()),t&&!t.match(r)&&(t=t&&t.trim(),o.push(e.message));const i={errors:o,warnings:[]};return n&&n(i),i}}function y(e){return function(t,n){t=t&&t.trim();const r=[],o=new Date(t);t&&!o.getTime()&&r.push(e.message);const i={errors:r,warnings:[]};return n&&n(i),i}}function E(e){return function(t,n){const r=[];(t=t&&t.trim())&&!t.match(/^([01]?[0-9]|2[0-3]):[0-5][0-9]$/)&&r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function x(e){return function(t,n){const r=[];e.pattern.test(t)||r.push(e.message);const o={errors:r,warnings:[]};return n&&n(o),o}}function A(e,t){const n=e.map(e=>e(t).errors);return[].concat(...n)}function C(e,t){let n="";return t.some(t=>{const r=t(e);return r.errors.length>0&&(n=r.errors[0],!0)}),n}},dtqy:function(e,t,n){var r=n("q1tI"),o=n.n(r),i=n("/MKj"),s=n("qWlA"),a=n("5S2N"),c=n("fArA"),u=n("U4JR");function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=Object(c.compose)(Object(i.connect)(({pins:e},{pinId:t,carouselSlotCurrentIndex:n})=>{const{carousel_data:r}=e&&t&&e[t]||{},{index:o}=r||{};return void 0!==n?{carouselSlotCurrentIndex:o||n||0}:{}}),(function(e){return class extends r.PureComponent{constructor(...e){super(...e),l(this,"state",{showEditModal:!1}),l(this,"onHide",()=>{this.setState({showEditModal:!1}),this.props.onToggleModal&&this.props.onToggleModal(!1)}),l(this,"handlePinEditButtonClick",Object(s.a)(e=>{e&&e.stopPropagation();const{component:t,onToggleModal:n}=this.props;n&&n(!0),Object(u.a)(101,{element:3,...t?{component:t}:{}}),this.setState({showEditModal:!0})}))}render(){const{pinId:t,onDelete:n,onSubmit:i,carouselSlotCurrentIndex:s}=this.props,{showEditModal:c}=this.state,u={...this.props,handlePinEditButtonClick:this.handlePinEditButtonClick};return o.a.createElement(r.Fragment,null,o.a.createElement(e,u),c&&o.a.createElement(a.a,{carouselSlotCurrentIndex:s,onDelete:n,onHide:this.onHide,onSubmit:i,pinId:t}))}}}))},eIuQ:function(e,t,n){n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return c}));var r=n("Ye/N");function o(e){return e?r.a._("Title too long. Make sure all cards' titles have less than 100 characters","Title entered is too long while editing a carousel pin and/or one of its pins","Title entered is too long while editing a carousel pin and/or one of its pins"):r.a._("Title too long. Make sure title has less than 100 characters","Title entered is too long while editing a pin","Title entered is too long while editing a pin")}function i(e){return e?r.a._("Description too long. Make sure all cards' descriptions have less than 500 characters","Description entered is too long while editing a carousel pin and/or one of its pins","Description entered is too long while editing a carousel pin and/or one of its pins"):r.a._("Description too long. Make sure description has less than 500 characters","Description entered is too long while editing a pin","Description entered is too long while editing a pin")}function s(e){return r.a._("Too many mentions. Make sure you have at most 5.","editPinModal.errorMessages.userMentionOverLimit","Too many mentions used in the description")}function a(e){return e?r.a._("Note too long. Make sure all cards' notes have less than 500 characters","User note entered is too long while editing a carousel pin and/or one of its pins","User note entered is too long while editing a carousel pin and/or one of its pins"):r.a._("Note too long. Make sure note has less than 500 characters","User note entered is too long while editing a pin","User note entered is too long while editing a pin")}function c(e){return e?r.a._("Need to provide a valid URL. Make sure all cards' links are valid","Invalid URL/link provided while editing a carousel pin and/or one of its pins","Invalid URL/link provided while editing a carousel pin and/or one of its pins"):r.a._("Need to provide a valid URL. Make sure the link is valid","Invalid URL/link provided while editing a pin","Invalid URL/link provided while editing a pin")}},jHGc:function(e,t,n){n.r(t),n.d(t,"PinRepEditButton",(function(){return c}));var r=n("q1tI"),o=n.n(r),i=n("Ye/N"),s=n("dtqy"),a=n("n6mq");function c({handlePinEditButtonClick:e,style:t,useLegoStyles:n=!1,usePersistentOneClickSaveStyles:r,wrappingIconStyle:s}){const c=o.a.createElement(a.p,{accessibilityLabel:i.a._("Edit","edit button on pin","edit button on pin"),bgColor:t&&t.bgColor||"white",icon:"edit",iconColor:t&&t.iconColor||"darkGray",onClick:({event:t})=>e(t),size:t&&t.size||"md"});return n||r?o.a.createElement("div",{style:{...s||{}}},c):c}t.default=Object(s.a)(c)},kwau:function(e,t,n){var r=n("/MKj");t.a=Object(r.connect)(({viewer:e})=>({viewer:e}))(({children:e,viewer:t})=>e(t))},mEMi:function(e,t,n){n.d(t,"a",(function(){return l}));var r=n("q1tI"),o=n.n(r),i=n("DzJC"),s=n.n(i);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const c=200,u=({scrollTop:e,clientHeight:t,scrollHeight:n},r)=>{return e+t+(r?r(t):2*t)>n};class l extends o.a.PureComponent{constructor(...e){super(...e),a(this,"setContainerRef",e=>{this.containerRef=e}),a(this,"fetchMoreIfNecessary",s()(()=>{const{fetchMore:e,scrollBuffer:t}=this.props;e&&this.containerRef&&u(this.containerRef,t)&&e()},c))}componentDidMount(){setTimeout(this.fetchMoreIfNecessary)}componentDidUpdate(){this.fetchMoreIfNecessary()}render(){const{children:e}=this.props;return e({onScroll:this.fetchMoreIfNecessary,setRef:this.setContainerRef})}}},mvLR:function(e,t,n){function r(e){let t=!1;return{promise:new Promise((n,r)=>{e.then(e=>t?r({isCanceled:!0}):n(e),e=>r(t?{isCanceled:!0}:e))}),cancel(){t=!0}}}n.d(t,"a",(function(){return r}))},oN2T:function(e,t,n){n.d(t,"b",(function(){return f})),n.d(t,"h",(function(){return m})),n.d(t,"f",(function(){return g})),n.d(t,"d",(function(){return _})),n.d(t,"l",(function(){return b})),n.d(t,"g",(function(){return E})),n.d(t,"c",(function(){return x})),n.d(t,"a",(function(){return A})),n.d(t,"k",(function(){return C})),n.d(t,"i",(function(){return w})),n.d(t,"j",(function(){return v})),n.d(t,"e",(function(){return I}));var r=n("4dcN"),o=n("Pqnw"),i=n("7w6Q"),s=n("eOdZ"),a=n("KFEb"),c=n("5FNA"),u=n("NjDU"),l=n("Wer7");const d="board_create",h="board_delete",p="board_edit";function f(e,t){return Object(l.a)("BoardResource",{board_id:e,field_set_key:t})}function m(){return(e,t)=>{const{viewer:n}=t();n.isAuth&&Object(c.b)(n.username).forEach(t=>{e(t)})}}function g(e){const t={...e};return n=>(n({type:"BOARD_CREATE",payload:{board:e}}),s.a.create("BoardResource",t).callCreate().then(e=>{r.a.trackEvent(d,"success");const o=e.resource_response.data;return o&&(n(m()),n(function(e={},t,n){return{type:"BOARD_CREATE_COMPLETE",payload:{options:e,board:t},error:n}}(t,o))),o}).catch(e=>{throw r.a.trackEvent(d,"error"),e}))}function _(e={},t,n){return{type:"BOARD_UPDATE_COMPLETE",payload:{options:e,board:t},error:n}}function b(e){return t=>{const n=void 0===e.collaborator_requests_enabled||null===e.collaborator_requests_enabled?{}:{collaborator_requests_enabled:e.collaborator_requests_enabled},o={board_id:e.id,name:e.name,description:e.description,category:e.category,event_date:e.event_date,event_start_date:e.event_start_date,collaborator_permissions_setting:e.collaborator_permissions_setting,privacy:e.privacy,collab_board_email:e.collab_board_email,collaborator_invites_enabled:e.collaborator_invites_enabled,allow_homefeed_recommendations:e.allow_homefeed_recommendations,...n};return t({type:"BOARD_UPDATE",payload:{boardUpdateOptions:o}}),s.a.create("BoardResource",o).callUpdate().then(n=>{r.a.trackEvent(p,"success");const i=n&&n.resource_response&&n.resource_response.data||e;t(_(o,i))}).catch(e=>{throw r.a.trackEvent(p,"error"),e})}}function y(e,t){return{type:"BOARD_DELETE_COMPLETE",payload:{boardId:e},error:t}}function E(e){return(t,n)=>{const o=n().boards.content[e],{pin_count:i}=o,{id:a}=o.owner;return t({type:"BOARD_DELETE",payload:{boardId:e}}),s.a.create("BoardResource",{board_id:e}).callDelete().then(()=>{r.a.trackEvent(h,"error"),t(y(e)),t(Object(u.b)({userId:a,increment:-i}))}).catch(e=>{throw r.a.trackEvent(h,"error"),e})}}function x(e){return{type:"BOARD_PIN_TO",payload:{board:e}}}function A(e){return t=>(t(function(e){return{type:"BOARD_ARCHIVED",payload:{boardId:e}}}(e)),s.a.create("BoardArchiveResource",{boardId:e}).callUpdate())}function C(e){return t=>(t(function(e){return{type:"BOARD_UNARCHIVED",payload:{boardId:e}}}(e)),s.a.create("BoardArchiveResource",{boardId:e}).callDelete())}function w(e,t){return n=>s.a.create("BoardsMergeResource",{source_board_id:e,target_board_id:t}).callUpdate().then(()=>Promise.all([n(y(e)),n(f(t,"pin_count")),n(Object(o.a)(a.a.BOARD_SECTIONS,t))]))}function v(e,t){return n=>s.a.create("SocialSearchCampaignResource",{boardId:e}).callGet().then(e=>{if(!e||!e.resource_response){return n({type:"SET_SOCIAL_SEASONAL_BOARD",payload:{isSocialSeasonalBoard:!1,socialHeaderBgImage:"",socialHeaderBgColor:"",textIconColor:""}})}const r=e.resource_response.data||{},o=(r.model||{}).custom_properties||{},{campaign_id:s="unknown"}=o,a=r.display_data||{},c={isSocialSeasonalBoard:!!r.display_data,socialHeaderBgImage:a.header_image,socialHeaderBgColor:a.header_background_color,textIconColor:a.text_icon_color};return i.a.increment(`web.seasonal_board.${s}.${t}.land`),n({type:"SET_SOCIAL_SEASONAL_BOARD",payload:c})})}function I(){return e=>{return e({type:"SET_SOCIAL_SEASONAL_BOARD",payload:{isSocialSeasonalBoard:!1,socialHeaderBgImage:"",socialHeaderBgColor:"",textIconColor:""}})}}},"q/rS":function(e,t,n){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}));const r={HEADING:"story_pin_heading_block",IMAGE:"story_pin_image_block",INGREDIENT:"story_pin_ingredient_block",LINK:"story_pin_link_block",PARAGRAPH:"story_pin_paragraph_block",SUPPLY:"story_pin_supply_block",VIDEO:"story_pin_video_block"},o={alignment:1,hex_color:"#111111",highlight_color:"#FFFFFF",vertical_alignment:1},i={...o,font:{default_size:28,letter_spacing:-.4,line_height:1.25,name:"Graphik Regular",url:"https://pinterest-taipei.s3.amazonaws.com/Graphik-Regular.otf"},font_size:28}},vxan:function(e,t,n){n.d(t,"a",(function(){return s}));var r=n("q1tI"),o=n("mvLR");function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t,n;return n=t=class extends r.Component{constructor(...e){super(...e),i(this,"makeCancelablePromise",(e,t)=>{if(t){const e=this.cancelCallbackMap[t];e&&(e(),delete this.cancelCallbackMap[t])}const{cancel:n,promise:r}=Object(o.a)(e);return t?this.cancelCallbackMap[t]=n:this.cancelCallbacks.push(n),r}),i(this,"cancelCallbacks",[]),i(this,"cancelCallbackMap",{})}componentWillUnmount(){[...Object.keys(this.cancelCallbackMap).map(e=>this.cancelCallbackMap[e]),...this.cancelCallbacks].forEach(e=>e()),this.cancelCallbacks=[],this.cancelCallbackMap={}}render(){return r.createElement(e,Object.assign({},this.props,{makeCancelablePromise:this.makeCancelablePromise}))}},i(t,"displayName",`WithPromiseCancellation(${e.displayName||e.name||"Component"})`),n}},"zy/z":function(e,t,n){var r=n("q1tI"),o=n.n(r),i=n("Cufx"),s=n("Ye/N"),a=n("eOdZ"),c=n("LT60"),u=n("vxan"),l=n("joD6"),d=n("fArA"),h=n("TiQD"),p=n("n6mq");function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const m=5,g=27,_=38,b=40,y=13;var E=Object(d.compose)(u.a,l.a)(class extends o.a.PureComponent{constructor(...e){super(...e),f(this,"state",{recommendations:[],selectedIndex:0,resourceLoaded:!1}),f(this,"mounted",!1),f(this,"addMention",e=>{this.props.addMention(e),this.setState({recommendations:[]})}),f(this,"handleKeyDown",e=>{const t={[_]:this.handlePrevMention,[b]:this.handleNextMention,[g]:this.handleClose,[y]:this.handleSubmit},n=e&&e.keyCode;n&&Object.keys(t).includes(n.toString())&&t[n](e)}),f(this,"handlePrevMention",e=>{e.preventDefault(),this.state.selectedIndex>0&&this.setState(e=>({selectedIndex:e.selectedIndex-1}))}),f(this,"handleNextMention",e=>{e.preventDefault(),this.state.selectedIndex<this.state.recommendations.length-1&&this.setState(e=>({selectedIndex:e.selectedIndex+1}))}),f(this,"handleClose",e=>{e.preventDefault(),e.stopPropagation(),this.setState({recommendations:[]})}),f(this,"handleSubmit",e=>{e.preventDefault(),this.addMention(this.state.recommendations[this.state.selectedIndex])}),f(this,"callResource",e=>{const{makeCancelablePromise:t,viewer:n,inMentionWebExp:r}=this.props;r?t(a.a.create("UserMentionTypeaheadResource",{query:e,num_people:m}).callGet(),"userMentionTypeahead").then(e=>{if(!this.mounted)return;const t=e.resource_response.data;this.setState({recommendations:t.filter(e=>e.id!==(n.id||null)),resourceLoaded:!0})}).catch(({isCanceled:e})=>{e||this.setState({resourceLoaded:!1})}):t(a.a.create("TypeaheadResource",{num_boards:0,count:10,term:e,tag:"pinners"}).callGet(),"typeahead").then(e=>{if(!this.mounted)return;const t=e.resource_response.data;this.setState({recommendations:t.items.filter(e=>e.id!==(n.id||null)).slice(0,m),resourceLoaded:!0})}).catch(({isCanceled:e})=>{e||this.setState({resourceLoaded:!1})})})}componentDidMount(){this.mounted=!0,this.callResource(this.props.query),window.addEventListener("keydown",this.handleKeyDown)}UNSAFE_componentWillReceiveProps(e){e.query!==this.props.query&&""!==e.query&&this.callResource(e.query)}componentWillUnmount(){window.removeEventListener("keydown",this.handleKeyDown),this.mounted=!1}render(){const{recommendations:e,resourceLoaded:t,selectedIndex:n}=this.state,{anchor:r,idealDirection:a,inMentionWebExp:u}=this.props,l=a||"down",d="flyout_"+this.state.recommendations.length;return t&&e.length>0&&o.a.createElement(c.a,null,o.a.createElement(p.s,null,o.a.createElement(p.d,{position:"absolute",top:!0,dangerouslySetInlineStyle:{__style:{zIndex:h.a}}},o.a.createElement(p.l,{key:d,anchor:r,idealDirection:l,onDismiss:()=>{},positionRelativeToAnchor:!1,size:"md"},o.a.createElement(p.d,{padding:2,width:"100%"},e.map((e,t)=>o.a.createElement(p.O,{key:e.id,onMouseEnter:()=>{this.setState({selectedIndex:t})},onTap:()=>this.addMention(e)},o.a.createElement(p.d,{display:"flex",alignItems:"center",color:t===n?"lightGray":"transparent",rounding:4},o.a.createElement(p.d,{padding:1},o.a.createElement(i.a,{size:"sm",src:e.image_medium_url,name:e.full_name,verified:e.verified_identity&&e.verified_identity.verified})),o.a.createElement(p.d,{marginStart:2,marginEnd:2,overflow:"hidden"},o.a.createElement(p.P,{truncate:!0,weight:"bold",color:"darkGray"},e.full_name),u&&o.a.createElement(p.d,{dangerouslySetInlineStyle:{__style:{whiteSpace:"nowrap"}}},o.a.createElement(p.P,{size:"sm",color:"darkGray"},e.username,e.explicitly_followed_by_me&&` • ${s.a._("Following","mentions.mentionsFlyout.following","Label to tell the user that they are viewing a user they follow")}`)))))))))))}}),x=n("/5zs"),A=n("zywm"),C=n("pLLR");function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const v=/@[a-zA-Z0-9_-]*/,I="g",R=["ArrowDown","ArrowUp","ArrowLeft","ArrowRight","Escape","Shift","Alt","Control","Meta"],S=0,M=13,O={boxSizing:"border-box",display:"inline-block",minWidth:"100%",outline:"none"};class T extends r.PureComponent{constructor(...e){super(...e),w(this,"state",{flyoutCursorIndex:0,isMentionFlyoutOpen:!1,mentionQuery:"",textValue:""}),w(this,"getTextCursorPosition",()=>{const e=window.getSelection(),t=e.getRangeAt(0),n=e.anchorNode;return{cursorIndex:t.startOffset,selectedElement:n}}),w(this,"getHTMLCursorPosition",()=>{const{cursorIndex:e,selectedElement:t}=this.getTextCursorPosition();if(t){let n=e;const r=t.parentNode;r!==this._textAreaRef&&(n+=r.outerHTML.length-r.innerHTML.length-(3+r.tagName.length));let o=t.previousSibling;for(;o;)n+=o.outerHTML&&o.outerHTML.length||o.textContent.length,o=o.previousSibling;return{cursorIndex:n,parentElement:r}}return{cursorIndex:-1}}),w(this,"setRef",e=>{this.props.setRef(e),this._textAreaRef=e}),w(this,"focusTextAreaAndPostionCursor",(e=!1)=>{const t=window.getSelection(),n=document.createRange();if(e&&this._textAreaRef)n.selectNodeContents(this._textAreaRef),n.collapse(!1);else if(t.anchorNode){const e=t.getRangeAt(0),r=e.startOffset,o=e.startContainer;n.setStart(o,r),n.collapse(!0),this._textAreaRef&&o===this._textAreaRef&&(n.selectNodeContents(this._textAreaRef),n.collapse(!1))}else this._textAreaRef&&(n.selectNodeContents(this._textAreaRef),n.collapse(!1));t.removeAllRanges(),t.addRange(n),this._textAreaRef&&this._textAreaRef.focus()}),w(this,"handleKeyDown",e=>{const{handleEnter:t}=this.props;!this.state.isMentionFlyoutOpen&&e.which===M&&t&&(e.preventDefault(),t(e.target.textContent))}),w(this,"handleKeyUp",e=>{const{parentElement:t}=this.getHTMLCursorPosition(),{cursorIndex:n}=this.getTextCursorPosition(),r=n===t.textContent.length,o=t.className===A.b;o&&t.getAttribute(A.a)>t.textContent.length?this.handleRemoveMention(t):!o||0===e.which||R.includes(e.key)||r?t.className===A.b&&r&&this.placeCaretAfterNode(t):this.handleRemoveSpan(t);const i=e.target.textContent;this.props.onChange&&this.props.onChange(i!==this.props.textValue),this.props.onTextChange&&this.props.onTextChange()}),w(this,"handleAddMention",e=>{const t=this.state.flyoutCursorIndex,n=t+this.state.mentionQuery.length+1,r=this._textAreaRef,o=r&&r.innerHTML.slice(0,t)||"",i=r&&r.innerHTML.slice(n)||" ",s=e.first_name||e.full_name,a=this.inMentionWebExp?`@${e.username}`:s,c=`${o}${Object(A.c)(e.id,a).outerHTML}${i}`;this.props.updateTags&&this.props.updateTags(e),this.setState({textValue:c,mentionQuery:"",isMentionFlyoutOpen:!1},()=>{this.focusTextAreaAndPostionCursor(),this.props.onTextChange&&this.props.onTextChange()})}),w(this,"handleRemoveMention",e=>{this._textAreaRef&&this._textAreaRef.replaceChild(document.createTextNode(""),e)}),w(this,"handleRemoveSpan",e=>{this._textAreaRef&&(this._textAreaRef.replaceChild(document.createTextNode(e.textContent),e),this.setState({textValue:this._textAreaRef&&this._textAreaRef.innerHTML||""},this.focusTextAreaAndPostionCursor))}),w(this,"handleInput",e=>{const{cursorIndex:t}=this.getHTMLCursorPosition();let n="";const r=e.target.innerHTML,o=new RegExp(v,I);let i=o.exec(r),s=o.lastIndex<t;for(;i&&s;)i=o.exec(r),s=o.lastIndex<t;n=i&&i.index<t?i[S]:"";const a=this.state.isMentionFlyoutOpen?this.state.flyoutCursorIndex:r.slice(0,t).lastIndexOf("@"),c=n.substring(1);this.setState({flyoutCursorIndex:a,mentionQuery:c,isMentionFlyoutOpen:!!n}),this.props.handleInput&&this.props.handleInput(e.target.textContent)}),w(this,"handlePaste",e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,t)}),w(this,"placeCaretAfterNode",e=>{const t=e.textContent,n=e.getAttribute(A.a),r=t.substring(n),o=t.substring(0,n);e.innerHTML=o;const i=document.createRange();i.setStartAfter(e);const s=document.createTextNode(r);i.insertNode(s),i.collapse(!1);const a=window.getSelection();a.removeAllRanges(),a.addRange(i)})}componentDidMount(){this.inMentionWebExp=new x.d(this.props.requestContext,"cp_mention_web").enabled(),this.setState({textValue:this.props.replyToObject?Object(A.f)(this.props.existingTags,this.props.taggedUsers,this.props.textValue,this.props.replyToObject,this.inMentionWebExp):Object(A.f)(this.props.existingTags,this.props.taggedUsers,this.props.textValue)},()=>{this.focusTextAreaAndPostionCursor(!0)})}componentDidUpdate(e,t){this.state.isMentionFlyoutOpen&&!this.props.shouldLoseFocus&&this.focusTextAreaAndPostionCursor()}render(){const{disabled:e,style:t={},suggestionAnchor:n,handleBlur:r,handleFocus:i}=this.props,{isMentionFlyoutOpen:s,mentionQuery:a,textValue:c}=this.state;return o.a.createElement(p.d,{alignItems:"center",width:"100%"},o.a.createElement("div",{contentEditable:!e,"data-test-id":"mentionsInput",name:"mentionsInput",onBlur:r,onFocus:i,onInput:this.handleInput,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onPaste:this.handlePaste,ref:this.setRef,role:"textbox",style:Object.assign({},t,O),tabIndex:"0",dangerouslySetInnerHTML:{__html:c}}),n&&s&&o.a.createElement(E,{addMention:this.handleAddMention,anchor:n,query:a,inMentionWebExp:this.inMentionWebExp}))}}w(T,"defaultProps",{handleFocus:()=>{},existingTags:[],taggedUsers:[]});t.a=Object(C.f)(T)},zywm:function(e,t,n){n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return u}));const r="data-length",o="communityEditorMention",i=e=>{let t=e.previousSibling,n=0;for(;t;)n+=t.textContent.length,t=t.previousSibling;return n},s=e=>{let t=[];if(e&&e.children){Array.from(e.children).forEach(e=>{if(e.className===o){const n=e.getAttribute("data-user-id")||"",r=e.textContent||"";t=t.concat({object_id:n,length:r.length,offset:i(e),tag_type:1})}})}return t},a=(e,t,n)=>(n&&n.forEach(e=>{t[e.id]=e}),JSON.stringify(s(e))),c=(e,t,n=!1)=>{const i=document.createElement("span");return i.setAttribute("style","font-weight: bold; color: #0074e8"),i.setAttribute("data-user-id",`${e}`),i.setAttribute(r,`${t.length}`),n&&i.setAttribute("data-reply-to","true"),i.setAttribute("class",o),i.innerText=t,i},u=(e,t,n,r={},o)=>{let i=0,s="";if(r&&r.user){const t=`@${r.user.username}`,a=r.user.first_name||r.user.full_name,u=o?t:a;if((!n||n.substring(i,u.length)===u)&&(s=`${c(r.user.id,u,!0).outerHTML} `,i=u.length,e.shift(),n&&n.trim().length===u.length))return s}return n&&(e.forEach((e,r)=>{const o=t&&t.length>0&&t[r].id||e.object_id,a=n.substr(e.offset,e.length),u=n?n.substring(i,e.offset):"";i=e.offset+e.length,s=`${s}${u}${c(o,a).outerHTML}`}),s=`${s}${n.substring(i)}`),s}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/js/50-c9cd6bf2213cdf0346d2.mjs.map
